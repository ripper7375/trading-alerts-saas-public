The failing job is caused by failing tests in **tests**/api/indicators.test.tsâ€”specifically the cases checking error handling for the GET /api/indicators/[symbol]/[timeframe] API route. The tests expect two outcomes when errors are triggered:

- For an MT5 service error: response.status should be 500 and data.error should be 'MT5 service error'.
- For an unknown error: response.status should be 500 and data.error should be 'Internal server error'.

Reviewing app/api/indicators/[symbol]/[timeframe]/route.ts at ref c2455944d11ea719cd177f539b89aa9643f36b47, your error handling logic for MT5ServiceError and generic errors appears correct and matches the expectations from the test.

However, the test failure often indicates:

- The thrown error does not match the error type checked in the catch block.
- The mocks for MT5ServiceError (coming from @/lib/api/mt5-client) do not match the type used in the route implementation (e.g., two different class definitions in test and production code).

Solution:
Make sure you are importing and using the _same_ MT5ServiceError and MT5AccessDeniedError classes in both your test file and your API route implementation. If you are mocking them in the test with jest.mock, ensure that your mock definition matches the actual shape and prototype chain of the real error class. Doing otherwise prevents "instanceof" checks from succeeding.

**Code suggestion:**  
In your test setup, instead of re-creating the error class inside the jest.mock call, import the actual classes. Remove the local mock for MT5ServiceError and MT5AccessDeniedError:

```typescript
// In __tests__/api/indicators.test.ts
import { MT5ServiceError, MT5AccessDeniedError } from '@/lib/api/mt5-client';

// Then, in mocks:
jest.mock('@/lib/api/mt5-client', () => {
  const actual = jest.requireActual('@/lib/api/mt5-client');
  return {
    ...actual,
    fetchIndicatorData: jest.fn(),
  };
});
```

And use the imported error classes directly in your test logic.
For example:

```typescript
mockFetchIndicatorData.mockRejectedValue(
  new MT5ServiceError('Service unavailable', 503)
);
```

This will ensure the thrown error in tests will pass the instanceof check in your error handler:  
https://github.com/ripper7375/trading-alerts-saas-public/blob/c2455944d11ea719cd177f539b89aa9643f36b47/app/api/indicators/[symbol]/[timeframe]/route.ts#L395

This change should resolve the test failures for job 59019956428.
