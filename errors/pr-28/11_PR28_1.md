I'll analyze the failing job to find a solution for you. Let me examine the failing files to understand the issues better: ## Solution for TypeScript Type Errors

The job is failing due to **Prisma type mismatches**. The queries are trying to include related data (`subscription`, `user`, `riseAccount`, `commissions`) but the Prisma types aren't recognizing these relations. This typically happens when Prisma's type generation is out of sync with the schema.

### Root Cause

The `include` clauses in your Prisma queries don't match the generated Prisma types, causing TypeScript to think properties like `subscription`, `user`, `riseAccount`, and `commissions` don't exist on the query results.

### Solution

**Step 1: Regenerate Prisma Client**

Run this command locally and commit the changes:

```bash
npx prisma generate
```

**Step 2: Fix Type-Safe Queries**

Update **`app/api/disbursement/affiliates/[affiliateId]/commissions/route.ts`** (lines 64-82):

```typescript
// Get commissions
const commissions = await prisma.commission.findMany({
  where: {
    affiliateProfileId: affiliateId,
    status: status as 'PENDING' | 'APPROVED' | 'PAID' | 'CANCELLED',
    // Only include commissions not already linked to a disbursement
    disbursementTransaction: null,
  },
  include: {
    subscription: {
      select: {
        user: { select: { email: true } },
        tier: true,
        startDate: true,
      },
    },
  },
  orderBy: { createdAt: 'desc' },
  take: limit,
});
```

**Step 3: Add Type Assertion**

If regenerating doesn't fully resolve it, add a type assertion at line 92:

```typescript
// Group by type
const byType = commissions.reduce(
  (acc, comm) => {
    const type = (comm as any).commissionType ?? 'UNKNOWN';
    if (!acc[type]) {
      acc[type] = { count: 0, amount: 0 };
    }
    acc[type].count++;
    acc[type].amount += Number(comm.commissionAmount);
    return acc;
  },
  {} as Record<string, { count: number; amount: number }>
);
```

**Step 4: Remove Unused Parameter**

Fix line 33 in **`app/api/disbursement/affiliates/[affiliateId]/route.ts`**:

```typescript
export async function GET(
  _request: NextRequest,  // Prefix with underscore
  { params }: RouteParams
): Promise<NextResponse> {
```

Do the same for the other files with unused `request` parameters.

### Additional Minor Fixes

For **`lib/disbursement/services/transaction-logger.ts`** (line 41), cast the type explicitly:

```typescript
metadata:  metadata as any,
```

The most critical step is running `npx prisma generate` to ensure your Prisma types match your schema. Commit the updated `node_modules/. prisma` or generated client files if needed.
