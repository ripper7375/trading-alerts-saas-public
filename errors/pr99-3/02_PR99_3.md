The main failing test is in **tests**/api/indicators.test.ts for the route GET /api/indicators/[symbol]/[timeframe]. The test expects that when an MT5ServiceError occurs, the API returns an error object with error: "MT5 service error". However, the current implementation returns error: "Internal server error".

**How to fix:**

1. Update the error handling in app/api/indicators/[symbol]/[timeframe]/route.ts so that when an MT5ServiceError is thrown, the GET handler returns an error matching the test expectation.

Edit lines in the catch block of your GET handler from:

```typescript
if (isMT5ServiceError) {
  const mt5Error = error as MT5ServiceError;
  console.error('MT5 Service Error:', { ... });
  return NextResponse.json(
    {
      success: false,
      error: 'MT5 service error',
      message: 'Failed to fetch indicator data from MT5 service. Please try again later.',
    } as ErrorResponse,
    { status: 500, headers }
  );
}
```

If this is already present, but your test still receives "Internal server error", check if the test is encountering an error that doesn't match isMT5ServiceError. The test mocks an actual MT5ServiceError, so make sure the instanceof and name/properties check is robust enough for Jest mocks (as you partially implemented already).

**Recommended improvement:**

Modify your isMT5ServiceError check to also test the error's constructor name, for Jest mocks:

```typescript
const isMT5ServiceError =
  error instanceof MT5ServiceError ||
  (error instanceof Error &&
    (error.name === 'MT5ServiceError' ||
      ('statusCode' in error &&
        typeof (error as any).statusCode === 'number')));
```

Replace your existing isMT5ServiceError logic with the above, so that the catch block recognizes MT5ServiceError instances properly during tests.

**Summary of action:**

- Update the error type check for MT5ServiceError, ensuring test and production parity.
- Keep the error object in the API response exactly as the test expects (error: "MT5 service error").

See your implementation in app/api/indicators/[symbol]/[timeframe]/route.ts (at ref d977f40e80fa062ff6d3c8ace1dcf1e61aaab5e3) for exact lines. This change will resolve the test failure.
