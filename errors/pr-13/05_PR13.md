I'll analyze the failing job to find a solution for you. ## Solution for Job Failure

The TypeScript type-check is failing with 5 errors across 3 cron route files. Here are the fixes:

### 1. **CRON_SECRET Access Errors** (3 instances)

**Issue:** TypeScript requires bracket notation for index signature properties.

**Files affected:**

- `app/api/cron/distribute-codes/route.ts` (line 47)
- `app/api/cron/expire-codes/route.ts` (line 44)
- `app/api/cron/send-monthly-reports/route.ts` (line 110)

**Fix:** Change from dot notation to bracket notation:

```typescript
// Before (line 47, 44, 110 respectively)
const cronSecret = process.env.CRON_SECRET;

// After
const cronSecret = process.env['CRON_SECRET'];
```

### 2. **Missing Prisma Model** (line 63)

**Issue:** `affiliateCommission` model doesn't exist on the Prisma client.

**File:** `app/api/cron/send-monthly-reports/route.ts` (line 63)

**Fix:** Update the model name to match your Prisma schema (likely `affiliateCommission` should be `affiliateCommission` with correct casing):

```typescript
// Line 63 - Update to correct model name
const commissions = await prisma.affiliateCommission. aggregate({
```

Check your `prisma/schema.prisma` file for the exact model name. It might be:

- `affiliateCommissions` (plural)
- `AffiliateCommission` (PascalCase)

### 3. **Decimal Type Mismatch** (line 174)

**Issue:** Prisma's `Decimal` type cannot be directly assigned to `number`.

**File:** `app/api/cron/send-monthly-reports/route.ts` (line 174)

**Fix:** Convert the Decimal to number:

```typescript
// Line 174
balance: affiliate.pendingCommissions.toNumber(),
```

Or update the interface if it should accept Decimal:

```typescript
// Line 18-26 - Update interface
interface MonthlyReportData {
  affiliateId: string;
  email: string;
  month: string;
  codesDistributed: number;
  codesUsed: number;
  commissionsEarned: number;
  balance: number; // Keep as number and convert on line 174
}
```

Apply these fixes and the type-check should pass.
