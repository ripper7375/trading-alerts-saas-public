Here are the solutions for the two failing tests in job 59001976265:

---

### 1. Failing test in `__tests__/api/indicators.test.ts`

Test:  
GET /api/indicators/[symbol]/[timeframe] › should return indicator data for FREE tier with valid symbol/timeframe  
Error:  
`expect(data.data.proIndicatorsTransformed).toBeDefined()` is failing.

**Solution:**  
The issue is that `proIndicatorsTransformed` is not present in `data.data` for free tier users, but the test expects it to be defined. Looking at the test, you mock `transformProIndicators` to always return an object, but in your mocked indicator data (`mockData` in the test), you do not include the `proIndicatorsTransformed` property.

**Fix:**  
Update your mocked `mockData` to include this property, or ensure that your API response for the free tier always includes `proIndicatorsTransformed`. Here’s how you can adjust your test `mockData` in the relevant test case:

```typescript
const mockData = {
  ohlc: [{ time: 1234567890, open: 1900, high: 1910, low: 1890, close: 1905 }],
  horizontal: { peak_1: [], bottom_1: [] },
  diagonal: { ascending_1: [], descending_1: [] },
  fractals: { peaks: [], bottoms: [] },
  metadata: { symbol: 'XAUUSD', timeframe: 'H1', bars: 1000 },
  proIndicators: {},
  proIndicatorsTransformed: {}, // Add this line
};
```

Reference: [**tests**/api/indicators.test.ts](https://github.com/ripper7375/trading-alerts-saas-public/blob/3d1f45d1288a244159c75edfa1549d7ddc08df07/__tests__/api/indicators.test.ts#L311) (ref: 3d1f45d1288a244159c75edfa1549d7ddc08df07)

---

### 2. Failing test in `__tests__/lib/validations/auth.test.ts`

Test:  
resetPasswordSchema › should reject mismatched passwords  
Error:  
Test expects the error message to be `'Passwords do not match'`.

**Solution:**  
Your validation schema for reset password should have a `refinement` or `superRefine` call (if using zod) checking if `password` and `confirmPassword` match, and when they don't, it should push an issue with the message `'Passwords do not match'`. If your schema pushes a different error message or no message, this test will fail.

**Fix:**  
In your `resetPasswordSchema`, ensure the following code exists:

```typescript
.resetPasswordSchema = z.object({
  token: z.string(),
  password: z.string(/* ...your rules... */),
  confirmPassword: z.string()
}).superRefine((data, ctx) => {
  if (data.password !== data.confirmPassword) {
    ctx.addIssue({
      code: z.ZodIssueCode.custom,
      message: "Passwords do not match",
      path: ['confirmPassword'],
    });
  }
});
```

Reference: [**tests**/lib/validations/auth.test.ts](https://github.com/ripper7375/trading-alerts-saas-public/blob/3d1f45d1288a244159c75edfa1549d7ddc08df07/__tests__/lib/validations/auth.test.ts#L212) (ref: 3d1f45d1288a244159c75edfa1549d7ddc08df07)

---

Apply these fixes and your job should pass.
