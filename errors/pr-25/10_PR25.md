I'll analyze the failing job to find a solution for you. Now let me get the file where the error is occurring: ## Solution for TypeScript Type Error

The job is failing due to a TypeScript type mismatch on **line 149** in `lib/disbursement/services/commission-aggregator.ts`. The error indicates that `kycStatus` is typed as `string` but should be typed as `"none" | RiseWorksKycStatus`.

### The Problem

On lines 180-182, the code assigns `kycStatus` with a fallback logic:

```typescript
kycStatus: hasRiseAccount
  ? affiliate.riseAccount?. kycStatus ?? 'PENDING'
  : 'none',
```

The issue is that `affiliate.riseAccount?.kycStatus` is being inferred as type `string` from the database, but the `PayableAffiliate` type expects it to be a more specific union type.

### Solution

You need to explicitly cast `kycStatus` to the expected type. Update lines 180-182 to:

```typescript
kycStatus: hasRiseAccount
  ? (affiliate.riseAccount?. kycStatus as RiseWorksKycStatus) ?? 'PENDING'
  : 'none',
```

Or, if you want to ensure type safety with a runtime check, you can validate the value:

```typescript
kycStatus: hasRiseAccount
  ? ((affiliate.riseAccount?.kycStatus || 'PENDING') as RiseWorksKycStatus)
  : 'none',
```

### Alternative: Update the Type Definition

If the database schema for `riseAccount.kycStatus` is actually returning a string type, you may need to check your `@/types/disbursement` type definition for `PayableAffiliate` and ensure the `RiseWorksKycStatus` type matches what's in your Prisma schema. Make sure both are aligned.

Apply this fix to [line 181](https://github.com/ripper7375/trading-alerts-saas-public/blob/04a4f3f8b1dfc5830e5390004723dc76fd2558cd/lib/disbursement/services/commission-aggregator.ts#L181) and the type check should pass.
