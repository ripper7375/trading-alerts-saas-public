The job failed because the test "should handle MT5ServiceError" expects the API to return the error message "MT5 service error" (from ERROR_MESSAGES.MT5_SERVICE), but instead receives "Internal server error". This means that when an MT5ServiceError is thrown by fetchIndicatorData in app/api/indicators/[symbol]/[timeframe]/route.ts, the error-handling block is not returning the expected error message.

Reviewing the route, the catch block for MT5ServiceError is present, and the code is:

```typescript
if (error instanceof MT5ServiceError || isMT5ServiceError(error)) {
  const mt5Error = error as MT5ServiceError;
  console.error('MT5 Service Error:', {
    statusCode: mt5Error.statusCode,
    message: mt5Error.message,
    responseBody: mt5Error.responseBody,
    timestamp: new Date().toISOString(),
  });

  return NextResponse.json(
    {
      success: false,
      error: ERROR_MESSAGES.MT5_SERVICE,
      message: ERROR_DETAILS.MT5_SERVICE_FAILURE,
    } as ErrorResponse,
    { status: HTTP_STATUS.INTERNAL_SERVER_ERROR, headers }
  );
}
```

The test expects:

```typescript
expect(data.error).toBe(ERROR_MESSAGES.MT5_SERVICE);
```

but also expects:

```typescript
expect(data.message).toBe(...) // probably more specific
```

Your handler currently hardcodes `ERROR_DETAILS.MT5_SERVICE_FAILURE` to message.

**Solution:**

1. Ensure your ERROR_MESSAGES.MT5_SERVICE matches what the test expects (usually "MT5 service error").
2. Make sure the API is returning error and message fields correctly in the response body as the test expects.
3. If the test expects message to be "MT5 service error" instead of the detailed text from ERROR_DETAILS, set both error and message fields to this value:

```typescript
return NextResponse.json(
  {
    success: false,
    error: ERROR_MESSAGES.MT5_SERVICE,
    message: ERROR_MESSAGES.MT5_SERVICE, // make both fields consistent
  } as ErrorResponse,
  { status: HTTP_STATUS.INTERNAL_SERVER_ERROR, headers }
);
```

**Code Change Suggestion (in app/api/indicators/[symbol]/[timeframe]/route.ts, catch block for MT5ServiceError):**

```typescript
if (error instanceof MT5ServiceError || isMT5ServiceError(error)) {
  const mt5Error = error as MT5ServiceError;
  console.error('MT5 Service Error:', {
    statusCode: mt5Error.statusCode,
    message: mt5Error.message,
    responseBody: mt5Error.responseBody,
    timestamp: new Date().toISOString(),
  });

  return NextResponse.json(
    {
      success: false,
      error: ERROR_MESSAGES.MT5_SERVICE,
      message: ERROR_MESSAGES.MT5_SERVICE, // <-- Update here
    } as ErrorResponse,
    { status: HTTP_STATUS.INTERNAL_SERVER_ERROR, headers }
  );
}
```

This ensures the test receives the expected "MT5 service error" in both fields and should resolve the failing test.

Relevant code:  
[app/api/indicators/[symbol]/[timeframe]/route.ts (ref: c325c28c67580c6263a900bf23876df3c027f617)](https://github.com/ripper7375/trading-alerts-saas-public/blob/c325c28c67580c6263a900bf23876df3c027f617/app/api/indicators/[symbol]/[timeframe]/route.ts)  
Test:  
[**tests**/api/indicators.test.ts (ref: c325c28c67580c6263a900bf23876df3c027f617)](https://github.com/ripper7375/trading-alerts-saas-public/blob/c325c28c67580c6263a900bf23876df3c027f617/__tests__/api/indicators.test.ts)
