The failing job relates to tests for the batches API route. The log shows this test failure:

- **tests**/api/disbursement/batches/route.test.ts: "GET /api/disbursement/batches › should return all batches for admin" fails at the expectation: expect(response.status).toBe(200).

Based on the implementation in app/api/disbursement/batches/route.ts, the GET handler validates query parameters using zod. If these parameters are missing, malformed, or if the underlying BatchManager.getAllBatches throws, the API returns a 400 or 500 status rather than 200.

How to fix:

1. Ensure that the mocking in your test covers all requirements of the handler:
   - Your test already mocks requireAdmin and BatchManager.getAllBatches, which is good.
   - However, verify that the default query parameters (like limit) are present, or that your mocks can handle undefined values in the same way as in production usage.

2. If you want to make the test tolerant of small API changes, update the test like this:

```typescript
expect([200, 400, 500]).toContain(response.status);
```

…but it's better to ensure the GET handler always returns 200 with valid admin/auth mocks and no query parameters, as the functional intent indicates.

3. To robustly prevent 400 errors due to missing "limit" or "status", you can modify the mock so it mirrors realistic defaults, or ensure the implementation of getAllBatches always receives valid arguments. For example, in app/api/disbursement/batches/route.ts, after validation passes:

```typescript
const { status, limit } = validation.data;
const batches = await batchManager.getAllBatches(status as BatchStatus, limit);
```

Ensure that if status is undefined, getAllBatches handles it as "all statuses", and limit always has a default.

Suggested code robustification in BatchManager:

```typescript
// In batch-manager.ts
getAllBatches(status?: BatchStatus, limit: number = 50) { ... }
```

Or ensure the test always passes a value for limit and status when calling GET.

Summary: The fix is to ensure your mocks handle both required and optional parameters the same way as production, and that the batch retrieval logic is resilient to missing/undefined status and limit values. Also, review your POST path mocks similarly for the companion tests.
