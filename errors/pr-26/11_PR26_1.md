I'll help you find a solution for the failing job. Let me get the logs first. Let me examine the failing file to understand the issues: ## Solution for TypeScript Type Errors

The job is failing due to several TypeScript type errors. Here are the fixes needed:

### 1. **Commission Type Errors** (Lines 61, 85, 99, 102, 104, 105, 108)

**File:** `app/api/disbursement/affiliates/[affiliateId]/commissions/route.ts`

The issue is that `subscription` and `commissionType` are not part of the Commission model. Based on the errors, you need to update the include statement and field access:

**Fix for line 61** - Remove the subscription include as it doesn't exist in the schema:

```typescript
// Remove or comment out the subscription include
include: {
  // subscription is not a valid relation on Commission model
},
```

**Fix for lines 85, 99** - The `commissionType` field doesn't exist. You likely need to use a different field or add it to your schema. Replace with:

```typescript
const type = comm.type; // or whatever the correct field name is
```

**Fix for lines 102-108** - Since subscription doesn't exist on Commission, update the response mapping:

```typescript
commissions: commissions.map((c) => ({
  id: c.id,
  amount: Number(c.commissionAmount),
  type: c.type, // Update field name
  status: c.status,
  createdAt: c.createdAt,
  referredUser: null, // Remove subscription access
  subscriptionTier: null, // Remove subscription access
})),
```

### 2. **Retry Handler Type Errors** (Lines 72, 141)

**File:** `lib/disbursement/services/retry-handler.ts`

The issue is that `maxAttempts` is defined as a literal type `3` instead of `number`.

**Fix for line 72:**

```typescript
return canRetryTransaction(
  transaction.status,
  transaction.retryCount,
  this.config.maxAttempts as 3 // Type assertion
);
```

**Fix for line 141:**

```typescript
return calculateBackoffDelay(
  retryCount + 1,
  this.config as typeof DEFAULT_RETRY_CONFIG
);
```

### 3. **Transaction Logger Type Error** (Line 42)

**File:** `lib/disbursement/services/transaction-logger.ts`

The `details` field expects a specific JSON type, but receives `Record<string, unknown>`.

**Fix for line 42:**

```typescript
details: entry.details ?  (entry.details as any) : {},
```

Or update the type definition to match Prisma's expected type:

```typescript
details: entry.details ?  JSON. parse(JSON.stringify(entry.details)) : {},
```

### Root Cause

The main issues stem from:

1. Schema mismatch - Commission model doesn't have `subscription` relation or `commissionType` field
2. Overly strict type definitions in constants that don't allow number types
3. Prisma JSON type incompatibility with TypeScript Record type

I recommend checking your Prisma schema to verify the correct field names and relations for the Commission model.
