I'll analyze the failing job to find a solution for you. Let me examine the failing tests to understand the issues: ## Solution for Failing Tests

You have 2 failing tests related to the disbursement orchestrator functionality. Both failures are due to **missing actual assertion errors in the logs**, but based on the test structure, here's what needs to be fixed:

### Issue 1: `orchestrator.test.ts` - Line 127

**Problem:** The test expects `result.successCount` to be 2, but it's likely returning a different value.

**Root Cause:** The mock setup for `disbursementTransaction.findUnique` at line 113-120 is returning the same `commissionId:  'comm-1'` for all transactions, but the test creates transactions with different commission IDs (`comm-1` and `comm-2`).

**Fix:**

```typescript
// Replace lines 113-120 with:
(mockPrisma.disbursementTransaction.findUnique as jest.Mock).mockImplementation(
  ({ where }) => {
    const txn = mockBatch.transactions.find(
      (t) => (t as any).transactionId === where.transactionId
    );
    return Promise.resolve(
      txn
        ? {
            ...txn,
            commissionId: txn.commissionId, // Use the transaction's own commissionId
          }
        : null
    );
  }
);
```

The issue is that the mock was hardcoding `commissionId: 'comm-1'` instead of using each transaction's actual `commissionId`.

### Issue 2: `batches/route.test.ts` - Line 129

**Problem:** The test at line 100-116 expects `data.batches` to have length 2, but the API might not be returning the expected structure.

**Root Cause:** The mock `mockGetAllBatches` is set up correctly, but the actual implementation might not be calling it or mapping the results properly.

**Fix:** Check the actual route implementation to ensure it's properly calling `batchManager.getAllBatches()`. The route file should look like:

```typescript
// In app/api/disbursement/batches/route.ts GET handler
const batches = await batchManager.getAllBatches(status);
return NextResponse.json({ batches }, { status: 200 });
```

If you need to see the actual route implementation to provide a more specific fix, let me know and I can retrieve that file.

### Quick Verification

After applying these fixes, run:

```bash
npm test -- __tests__/lib/disbursement/services/orchestrator.test.ts
npm test -- __tests__/api/disbursement/batches/route.test.ts
```
