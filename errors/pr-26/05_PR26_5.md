I'll analyze the failing job to find a solution. Let me get the logs first. Now let me examine the failing test files to understand the issues: ## Solution for Failing Tests

There are 3 failing tests related to missing mock implementations. Here's how to fix them:

### 1. **batch. test.ts** - Missing `disbursementTransaction. createMany` mock

**Issue:** Line 107 expects `disbursementTransaction.createMany` to be called, but it's not defined in the mock.

**Fix:** Add the missing mock to the `beforeEach` setup:

```typescript
beforeEach(() => {
  jest.clearAllMocks();
  mockPrisma = {
    paymentBatch: {
      create: jest.fn(),
      findUnique: jest.fn(),
      findMany: jest.fn(),
      update: jest.fn(),
      delete: jest.fn(),
    },
    disbursementTransaction: {
      createMany: jest.fn(), // ADD THIS LINE
    },
    disbursementAuditLog: {
      create: jest.fn(),
    },
  } as unknown as jest.Mocked<PrismaClient>;
  manager = new BatchManager(mockPrisma);
});
```

### 2. **orchestrator.test.ts** - Missing `disbursementTransaction.createMany` mock

**Issue:** Line 228 references `disbursementTransaction.createMany` but it's not mocked.

**Fix:** Add to the mock definition:

```typescript
beforeEach(() => {
  jest.clearAllMocks();
  mockPrisma = {
    paymentBatch: {
      findUnique: jest.fn(),
      update: jest.fn(),
    },
    disbursementTransaction: {
      findUnique: jest.fn(),
      update: jest.fn(),
      updateMany: jest.fn(),
      createMany: jest.fn(), // ADD THIS LINE
    },
    commission: {
      update: jest.fn(),
    },
    disbursementAuditLog: {
      create: jest.fn(),
    },
  } as unknown as jest.Mocked<PrismaClient>;

  mockProvider = new MockPaymentProvider({ delay: 0 });
  orchestrator = new PaymentOrchestrator(mockPrisma, mockProvider);
});
```

### 3. **route.test.ts** - Expects status 200 but gets different response

**Issue:** Line 132 expects status 200 but the actual implementation might be returning a different status or the mock isn't properly set up for the filtered query.

**Fix:** Ensure the `getAllBatches` mock handles the status parameter correctly:

```typescript
jest.mock('@/lib/disbursement/services/batch-manager', () => ({
  BatchManager: jest.fn().mockImplementation(() => ({
    getAllBatches: jest.fn().mockImplementation((status, limit) => {
      const allBatches = [
        {
          id: 'batch-001',
          batchNumber: 'BATCH-2025-001',
          paymentCount: 5,
          totalAmount: 500.0,
          status: 'PENDING',
          transactions: [],
          createdAt: new Date('2025-01-01'),
        },
        {
          id: 'batch-002',
          batchNumber: 'BATCH-2025-002',
          paymentCount: 3,
          totalAmount: 300.0,
          status: 'COMPLETED',
          transactions: [],
          createdAt: new Date('2025-01-02'),
        },
      ];

      // Filter by status if provided
      return Promise.resolve(
        status ? allBatches.filter((b) => b.status === status) : allBatches
      );
    }),
    createBatch: jest.fn().mockResolvedValue({
      id: 'batch-new',
      batchNumber: 'BATCH-2025-NEW',
      paymentCount: 2,
      totalAmount: 200.0,
      status: 'PENDING',
      transactions: [],
      createdAt: new Date(),
    }),
  })),
}));
```

Apply these changes and the tests should pass.
