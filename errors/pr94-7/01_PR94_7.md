The failing job is caused by a test failure in the suite for GET /api/indicators/[symbol]/[timeframe] ("should return indicator data for FREE tier with valid symbol/timeframe").

Based on the logs and current implementation:

- The endpoint’s GET handler validates session, parameters, tier, and then fetches indicator data via fetchIndicatorData.
- Your test (**tests**/api/indicators.test.ts) mocks this fetch and expects a certain response structure.
- Errors related to symbol/timeframe, authentication, and service failure are properly handled. However, the structure of the response and output expectations in your test and implementation must match exactly.

To resolve the failure:

1. Check the response structure in app/api/indicators/[symbol]/[timeframe]/route.ts (see lines 359–364):

```typescript
const response: IndicatorDataResponse = {
  success: true,
  data: dataWithTransformed,
  tier: userTier,
  requestedAt: new Date().toISOString(),
};
```

Ensure your test expects this exact structure—especially for fields like data, tier, and requestedAt.

2. If the test expects only a subset of fields or a differently shaped response, update the test assertion:

For example, replace:

```typescript
expect(data.data).toMatchObject(mockData);
```

with:

```typescript
expect(data).toMatchObject({
  success: true,
  data: expect.objectContaining(mockData),
  tier: 'FREE',
});
```

Or, adjust as needed if requestedAt is present.

3. If the actual handler omits or misnames a field (e.g., returns proIndicatorsTransformed as undefined or missing), ensure that after transformProIndicators, the object follows the contract your test expects.

4. Double-check that all mocks and imports in your test file match actual imports (especially for fetchIndicatorData and session mocks).

If code coverage upload is also failing, add your Codecov token as the repository’s secret (CODECOV_TOKEN) to address the tokenless upload error.

In summary, align your test’s expected response structure with the actual output from the route handler for the GET /api/indicators/[symbol]/[timeframe] endpoint and update your Codecov token if required. Review the actual output using console.log or by adding debug output in your test for further clarity.
