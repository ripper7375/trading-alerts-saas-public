openapi: 3.0.3
info:
  title: Trading Alerts SaaS - Watchlist System API (Part 10)
  version: 1.0.0
  description: |
    Watchlist System API for Trading Alerts SaaS platform (Part 10).

    This API provides watchlist management capabilities for tracking symbol+timeframe combinations.

    ## Features
    - Create and manage watchlist items
    - Tier-based limits (FREE: 5 items, PRO: 50 items)
    - Symbol and timeframe access validation
    - Drag-and-drop reordering
    - Duplicate prevention

    ## Tier-Based Access

    **FREE Tier:**
    - Max 5 watchlist items
    - 5 symbols (BTCUSD, ETHUSD, EURUSD, GBPUSD, USDJPY)
    - 2 timeframes (H1, D1)

    **PRO Tier:**
    - Max 50 watchlist items
    - 15 symbols (all major pairs)
    - 8 timeframes (M1, M5, M15, M30, H1, H4, D1, W1)

  contact:
    name: API Support
    email: support@tradingalerts.example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://api.tradingalerts.example.com
    description: Production server

security:
  - sessionAuth: []

tags:
  - name: Watchlist
    description: Watchlist management endpoints
  - name: Watchlist Items
    description: Individual watchlist item operations

paths:
  /api/watchlist:
    get:
      tags:
        - Watchlist
      summary: Get user's watchlist
      description: |
        Retrieves the user's watchlist with all items ordered by their position.

        **Features:**
        - Returns all watchlist items
        - Items sorted by order field
        - Auto-creates watchlist if doesn't exist
      operationId: getWatchlist
      responses:
        '200':
          description: Watchlist retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchlistResponse'
              example:
                success: true
                watchlist:
                  id: "wl_abc123"
                  name: "My Watchlist"
                  items:
                    - id: "wi_001"
                      symbol: "BTCUSD"
                      timeframe: "H1"
                      order: 0
                      createdAt: "2025-12-20T10:00:00Z"
                    - id: "wi_002"
                      symbol: "ETHUSD"
                      timeframe: "D1"
                      order: 1
                      createdAt: "2025-12-20T11:00:00Z"
                items:
                  - id: "wi_001"
                    symbol: "BTCUSD"
                    timeframe: "H1"
                    order: 0
                    createdAt: "2025-12-20T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
                message: "You must be logged in to view your watchlist"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Failed to fetch watchlist"
                message: "An error occurred while fetching your watchlist. Please try again."

    post:
      tags:
        - Watchlist
      summary: Add item to watchlist
      description: |
        Creates a new watchlist item with symbol+timeframe combination.

        **Validation:**
        - Checks tier limits (5 items for FREE, 50 for PRO)
        - Validates symbol access for user's tier
        - Validates timeframe access for user's tier
        - Prevents duplicate symbol+timeframe combinations
        - Auto-creates default watchlist if needed
      operationId: createWatchlistItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWatchlistItemRequest'
            examples:
              basic:
                summary: Add BTCUSD H1 to watchlist
                value:
                  symbol: "BTCUSD"
                  timeframe: "H1"
              withWatchlistId:
                summary: Add to specific watchlist
                value:
                  watchlistId: "wl_abc123"
                  symbol: "ETHUSD"
                  timeframe: "D1"
      responses:
        '201':
          description: Watchlist item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateItemResponse'
              example:
                success: true
                item:
                  id: "wi_003"
                  symbol: "GBPUSD"
                  timeframe: "H4"
                  order: 2
                  createdAt: "2025-12-20T12:00:00Z"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingSymbol:
                  summary: Symbol not provided
                  value:
                    success: false
                    error: "Invalid input"
                    message: "Symbol is required"
                missingTimeframe:
                  summary: Timeframe not provided
                  value:
                    success: false
                    error: "Invalid input"
                    message: "Timeframe is required"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
                message: "You must be logged in to add watchlist items"
        '403':
          description: Forbidden - tier limit or access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                limitReached:
                  summary: Watchlist limit reached
                  value:
                    success: false
                    error: "Watchlist limit reached"
                    message: "FREE tier allows maximum 5 watchlist items. Upgrade to PRO for 50 items."
                symbolDenied:
                  summary: Symbol not allowed
                  value:
                    success: false
                    error: "Symbol access denied"
                    message: "Symbol XAUUSD is not available in your FREE tier. Upgrade to PRO for access to all 15 symbols."
                timeframeDenied:
                  summary: Timeframe not allowed
                  value:
                    success: false
                    error: "Timeframe access denied"
                    message: "Timeframe M5 requires PRO tier."
        '409':
          description: Duplicate combination
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Duplicate combination"
                message: "This symbol+timeframe combination already exists in your watchlist."
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/watchlist/{id}:
    get:
      tags:
        - Watchlist Items
      summary: Get single watchlist item
      description: |
        Retrieves a specific watchlist item by ID with ownership validation.
      operationId: getWatchlistItem
      parameters:
        - name: id
          in: path
          required: true
          description: Watchlist item ID
          schema:
            type: string
          example: "wi_001"
      responses:
        '200':
          description: Watchlist item retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemResponse'
              example:
                success: true
                item:
                  id: "wi_001"
                  symbol: "BTCUSD"
                  timeframe: "H1"
                  order: 0
                  createdAt: "2025-12-20T10:00:00Z"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Invalid request"
                message: "Item ID is required"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - not owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden"
                message: "You do not have permission to view this item"
        '404':
          description: Item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Not found"
                message: "Watchlist item not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Watchlist Items
      summary: Update watchlist item
      description: |
        Updates a watchlist item's order position with ownership validation.

        **Note:** Currently only the 'order' field can be updated.
        For changing symbol/timeframe, delete and create a new item.
      operationId: updateWatchlistItem
      parameters:
        - name: id
          in: path
          required: true
          description: Watchlist item ID
          schema:
            type: string
          example: "wi_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWatchlistItemRequest'
            example:
              order: 3
      responses:
        '200':
          description: Watchlist item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemResponse'
              example:
                success: true
                item:
                  id: "wi_001"
                  symbol: "BTCUSD"
                  timeframe: "H1"
                  order: 3
                  createdAt: "2025-12-20T10:00:00Z"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - not owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Watchlist Items
      summary: Delete watchlist item
      description: |
        Deletes a watchlist item with ownership validation.
      operationId: deleteWatchlistItem
      parameters:
        - name: id
          in: path
          required: true
          description: Watchlist item ID
          schema:
            type: string
          example: "wi_001"
      responses:
        '200':
          description: Watchlist item deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
              example:
                success: true
                message: "Watchlist item deleted successfully"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - not owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/watchlist/reorder:
    post:
      tags:
        - Watchlist
      summary: Reorder watchlist items
      description: |
        Updates the order of multiple watchlist items in bulk.

        **Process:**
        - Accepts array of item IDs in desired order
        - Index in array becomes the new order value
        - Validates ownership of all items
        - Updates all items in a single transaction

        **Use case:** Drag-and-drop reordering in UI
      operationId: reorderWatchlistItems
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReorderWatchlistRequest'
            example:
              itemIds:
                - "wi_003"
                - "wi_001"
                - "wi_002"
      responses:
        '200':
          description: Watchlist items reordered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReorderResponse'
              example:
                success: true
                message: "Watchlist items reordered successfully"
                updatedCount: 3
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                emptyArray:
                  summary: No item IDs provided
                  value:
                    success: false
                    error: "Invalid input"
                    message: "At least one item ID is required"
                itemsNotFound:
                  summary: Some items not found
                  value:
                    success: false
                    error: "Invalid items"
                    message: "One or more watchlist items were not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - items not owned by user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden"
                message: "You do not have permission to reorder some of these items"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: next-auth.session-token
      description: NextAuth session cookie

  schemas:
    CreateWatchlistItemRequest:
      type: object
      required:
        - symbol
        - timeframe
      properties:
        watchlistId:
          type: string
          description: Optional watchlist ID (auto-created if not provided)
          example: "wl_abc123"
        symbol:
          type: string
          minLength: 1
          description: Trading symbol (must be allowed for user's tier)
          example: "BTCUSD"
        timeframe:
          type: string
          minLength: 1
          description: Timeframe (must be allowed for user's tier)
          example: "H1"

    UpdateWatchlistItemRequest:
      type: object
      properties:
        order:
          type: integer
          minimum: 0
          description: New order position
          example: 3

    ReorderWatchlistRequest:
      type: object
      required:
        - itemIds
      properties:
        itemIds:
          type: array
          items:
            type: string
          minItems: 1
          description: Array of item IDs in desired order
          example: ["wi_003", "wi_001", "wi_002"]

    WatchlistItem:
      type: object
      required:
        - id
        - symbol
        - timeframe
        - order
        - createdAt
      properties:
        id:
          type: string
          description: Unique item identifier
          example: "wi_001"
        symbol:
          type: string
          description: Trading symbol
          example: "BTCUSD"
        timeframe:
          type: string
          description: Chart timeframe
          example: "H1"
        order:
          type: integer
          description: Display order position
          example: 0
        createdAt:
          type: string
          format: date-time
          description: Item creation timestamp
          example: "2025-12-20T10:00:00Z"

    Watchlist:
      type: object
      required:
        - id
        - name
        - items
      properties:
        id:
          type: string
          description: Unique watchlist identifier
          example: "wl_abc123"
        name:
          type: string
          description: Watchlist name
          example: "My Watchlist"
        items:
          type: array
          items:
            $ref: '#/components/schemas/WatchlistItem'

    WatchlistResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
        watchlist:
          $ref: '#/components/schemas/Watchlist'
        items:
          type: array
          items:
            $ref: '#/components/schemas/WatchlistItem'
        error:
          type: string
        message:
          type: string

    ItemResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
        item:
          $ref: '#/components/schemas/WatchlistItem'
        error:
          type: string
        message:
          type: string

    CreateItemResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
        item:
          $ref: '#/components/schemas/WatchlistItem'
        error:
          type: string
        message:
          type: string

    DeleteResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Watchlist item deleted successfully"
        error:
          type: string

    ReorderResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Watchlist items reordered successfully"
        updatedCount:
          type: integer
          description: Number of items reordered
          example: 3
        error:
          type: string

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error type
          example: "Unauthorized"
        message:
          type: string
          description: Human-readable error message
          example: "You must be logged in to view your watchlist"
